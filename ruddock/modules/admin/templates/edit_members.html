{% extends "layout.html" %}

{% block head %}
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
{# CSS and JS for overlays #}
<script src="{{ url_for('static', filename='js/overlay.js') }}"></script>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/overlay.css') }}" />

<script>
/* Makes the select menu blank initially, without providing a blank option. */
$(document).ready(function() {
    $("#office_select").prop("selectedIndex", -1);
});

/* Provides an interface for selecting a member. */
function showSelectMemberUI() {
  showOverlay();

  var ui = document.createElement("div");
  $(ui).text("Select someone from the list below.");
  $(ui).append("<br><br>");
  var searchInput = document.createElement("input");
  searchInput.type = "text";
  searchInput.id = "memberSearchInput";
  searchInput.placeholder = "Search for a person...";
  $(searchInput).css({
      "width": "90%",
  });
  $(ui).append(searchInput);
  $(ui).append("<br><br>");

  var results = document.createElement("table");
  results.id = "memberSearchResults";
  $(ui).append(results);

  // Load the initial contents of the table.
  $.ajax({
    url: "{{ url_for('admin.ajax_get_members') }}",
    method: "GET",
    dataType: "json",
    success: function(response) {
      for (var i = 0; i < response.length; i++) {
        var member = response[i];
        var row = document.createElement("tr");
        $(row).prop("data-user-id", member.user_id);
        $(row).prop("data-name", member.name);
        var cell = document.createElement("td");
        $(cell).text(member.name);

        // Handle selecting the user.
        $(row).click(selectMember);

        $(row).append(cell);
        $(results).append(row);
      }
    },
  });

  // Set event handler for search input.
  $(searchInput).on("input", filterMembers);

  $(ui).css({
    "padding": "20px",
  });
  $("#overlayWindow").css({
    "height": "60%",
    "overflow": "auto",
  });
  $("#overlayWindow").append(ui);
  centerOverlay();
}

/* Filters the list of members using the search query. */
function filterMembers() {
  var query = $("#memberSearchInput").val();

  // If the query is cleared, everything should be shown.
  if (query.length === 0) {
    $("#memberSearchResults tr").show();
    return;
  }

  // Perform the search using an AJAX request.
  $.ajax({
    url: "{{ url_for('admin.ajax_search_members') }}",
    method: "GET",
    data: {
      query: query,
    },
    dataType: "json",
    success: function(response) {
      $("#memberSearchResults tr").each(function() {
        var user_id = $(this).prop("data-user-id");
        if ($.inArray(user_id, response) > -1) {
          $(this).show();
        } else {
          $(this).hide();
        }
      });
    },
  });
}

/* Executes the logic when a member is actually selected. */
function selectMember() {
  var user_id = $(this).prop("data-user-id");
  var name = $(this).prop("data-name");
  $("#selectedUser").val(user_id);
  $("#selectedName").text(name);
  closeOverlay();
}
</script>
{% endblock head %}

{% block body %}
<h2> Edit existing members</h2>
Use this to edit or delete a single member on the website.
<br><br>
Select a member:
<button type="button" onclick="showSelectMemberUI()">Choose...</button>
<br><br>
Selected member:
<input type="hidden" id="selectedUser" name="user_id" value="-1" />
<span id="selectedName">(None selected)</span>
<br><br>
Select an action below.<br>
<button class="edit_member_button" onclick="">Delete Member</button><br>
<button class="edit_member_button">Make Social Member</button><br>
<button class="edit_member_button">Make Full Member</button><br>
*Note: None of these buttons actually do anything yet.


{% endblock body %}

<!--

TO DO
buttons:
    delete member, convert to social, convert to full
    make them actually do something onclick
    change the color on hover
when a button is pressed, pull up the confirm page

-->
